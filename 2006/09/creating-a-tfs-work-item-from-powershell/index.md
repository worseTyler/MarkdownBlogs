---
title: "Creating a TFS Work Item from PowerShell"
date: "2006-09-26"
categories: 
  - "net"
  - "blog"
tags: 
  - "net"
---

I came across a [PowerShell script for creating TFS Work Items](https://netcave.org/PermaLink,guid,f1840c93-fc6f-4673-bdde-0af89add5ab9.aspx) from [Alan Stevens](https://netcave.org/) today.  There are a couple more thougts and ideas I would add.  Here is the output from my interactive PowerShell session (notice that I start with Alan's code to load the TFS assemblies.  However, I begin to vary shortly after that.

<table style="color: yellow; background-color: black;"><tbody><tr><td><span>&gt;$key = Get-ItemProperty HKLM:\SOFTWARE\Microsoft\VisualStudio\8.0 &gt;$dir = [string] (Get-ItemProperty $key.InstallDir) &gt;$dir += "PrivateAssemblies\" &gt;$lib = $dir + "Microsoft.TeamFoundation.WorkItemTracking.Client.dll" &gt;</span><span>[Reflection.Assembly]::LoadFrom($lib) &gt;$lib = $dir + "Microsoft.TeamFoundation.Client.dll" &gt;[Reflection.Assembly]::LoadFrom($lib) </span><span>&gt;$server="tfs" <strong>&gt;$NetCredentials=new-object System.Net.NetworkCredential ("Mark", "P@ssw0rd", "Michaelis") &gt; $tfs =new-object Microsoft.TeamFoundation.Client.TeamFoundationServer($server, $NetCredentials)</strong></span></td></tr></tbody></table>

To begin with I instantiate the TeamFoundationServer object rather than calling GetService().  This is because I want to change the network credentials that I use to connect to the server (see Buck Hodges post on this).

<table style="color: yellow; background-color: black;"><tbody><tr><td><span>&gt;$workItemStore = [Microsoft.TeamFoundation.WorkItemTracking.Client.WorkItemStore] &gt;$store=$tfs.GetService($workItemStore) <strong>&gt;$bug=$store.Projects["MSF for CMMI"].WorkItemTypes["Bug"].NewWorkItem() </strong>&gt;$bug.Title="The application isn't working" &gt;$bug.Save() <span style="color: yellow;"><strong><span style="color: red;">Exception calling "Save" with "0" argument(s): "TF26201: This work item has unsupported fields, or user does not have permissions."</span></strong></span></span></td></tr></tbody></table>

The next problem was that saving the bug results in an error.  I am pretty sure it is not permissions since I specified the credentials explicitly.  This leaves the unsupported fields option (whatever that means).  I check the Fields property and determine what the required fields are.  After setting these fields I am able to store the bug.  A non-zero ID and the revision number are just a few properties that verify the work item was successfully stored.

<table style="color: yellow; background-color: black;"><tbody><tr><td><span>&gt;$bug.Fields | where {$_.IsRequired -and (-not $_.IsValid)} | ft Name <span style="color: white;">Name ---- Symptom Steps To Reproduce <span style="color: yellow;">&gt;$bug.Fields["Symptom"].Value="Headache" &gt;$bug.Fields["Steps To Reproduce"].Value="Drink too much alcohol" &gt;$bud.Save()</span></span></span><span><span style="color: white;"><span style="color: yellow;"> <span style="font-family: Courier New;">&gt;$bug.Id <span style="color: #ffffff;">183</span> &gt;$store.GetWorkItem($bug.Id) <span style="color: white;">Id : 183 Uri : vstfs:///WorkItemTracking/WorkItem/183 Revision : 1 Revisions : {Microsoft.TeamFoundation.WorkItemTracking.Client.Revision} Attachments : {} Links : {} Store : Microsoft.TeamFoundation.WorkItemTracking.Client.WorkItemStore Title : The application isn't working State : Proposed Reason : New Rev : 1 Description : History : ChangedBy : Mark Michaelis (Administrator) RevisedDate : 1/1/0001 12:00:00 AM ChangedDate : 9/26/2006 2:49:10 AM CreatedDate : 9/26/2006 2:49:10 AM CreatedBy : Mark Michaelis (Administrator) NodeName : MSF for CMMI AreaPath : MSF for CMMI AreaId : 153 IterationPath : MSF for CMMI IterationId : 153 ExternalLinkCount : 0 HyperLinkCount : 0 AttachedFileCount : 0 RelatedLinkCount : 0 IsOpen : True IsPartialOpen : False IsReadOnlyOpen : False Fields : {Title, State, Rev, Changed By...} Type : Microsoft.TeamFoundation.WorkItemTracking.Client.WorkItemType Project : Microsoft.TeamFoundation.WorkItemTracking.Client.Project IsDirty : False DisplayForm : DisplayForm : &lt;FORM&gt; &lt;...&gt; &lt;/FORM&gt;</span></span></span></span></span><span style="font-family: Courier New;"></span></td></tr></tbody></table>

Just to make sure, I run a query for all active bugs to verify that mine is there.

<table style="color: yellow; background-color: black;"><tbody><tr><td><span>&gt;$store.Projects["MSF for CMMI"].StoredQueries | ft Name <span style="color: #ffffff;">Active Bugs All My Team Project Work Items All Tasks All Work Items Blocked Work Items Change Requests Copy of Issues Corrective Actions Customer Requirements Development Tasks Issues Mitigation Action Status My Work Items Product Requirements Resolved Bugs Reviews Risks <span style="color: yellow;">&gt;$query=$store.Projects["MSF for CMMI"].StoredQueries | where{$_.Name -eq "Active Bugs"} &gt;$store.Query($query.QueryText.Replace("@project", "'MSF for CMMI'")) <span style="color: white;">...</span></span></span><span style="color: white;"><span style="color: yellow;"><span style="color: #ffffff;"><span style="color: yellow;"></span></span></span></span></span></td></tr></tbody></table>

One PowerShell question I couldn't find the answer on, is how do I enter a password without displaying it on the screen.  The way RunAs works for example.
